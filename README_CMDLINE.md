# Параметры командной строки для arataga

## --admin-http-ip

`--admin-http-ip=[char-seq]`

**Обязательный параметр.**

Задает IP-адрес, на котором должен быть открыт административный HTTP-вход для управления arataga.

Может содержать IP-адрес (например, 127.0.0.1 или 192.168.1.1) или имя домена (например, `localhost`).

## --admin-http-port

`--admin-http-port=[ushort]`

**Обязательный параметр.**

Задает TCP-порт, на котором должен быть открыт административный HTTP-вход для управления arataga.

## --admin-token

`--admin-token=[char-seq]`

**Обязательный параметр.**

Задает значение для HTTP-заголовка `Arataga-Admin-Token`.

Заголовок `Arataga-Admin-Token` должен присутствовать во всех HTTP-запросах,
которые приходят на административный HTTP-вход. Значение этого заголовка задается в командной строке. Если заданное в командной строке значение не совпадает с тем, что получено в HTTP-запросе, то HTTP-запрос отвергается.

Пример:

`--admin-token=Our-Bigest-Secret-Word-Is-Abracadabra`

## --io-threads

`--io-threads=[uint]`

*Опциональный параметр.*

Задает количество рабочих нитей для выполнения сетевого ввода-вывода.

arataga создает несколько рабочих нитей при своем старте и далее обслуживает все описанные в конфигурации ACL только на контексте этих рабочих нитей. Так, если в конфигурации задано 1000 ACL, а arataga создал всего 4 рабочих нити для ввода-вывода, то каждая из этих нитей будет обслуживать по 250 ACL (arataga пытается равномерно распределить ACL между рабочими нитями).

Если аргумент `io-threads` не задан в командной строке, то arataga вычисляет количество нитей для ввода-вывода самостоятельно: `nCPU-2` или 2, если nCPU меньше или равно 2. Где `nCPU` -- это количество доступных ядер. Так, если arataga запущен на одноядерном процессоре, то будет создано 2 рабочих нити. Если на 4-х ядерном с hyperthreading, то будет создано 6 рабочих нитей (nCPU будет равен 8 в этом случае).

Но иногда может быть необходимо ограничить количество рабочих нитей для arataga. Например, если ACL всего 4, а arataga запускается на 16-ядерном процессоре. В этом случае количество рабочих нитей для операций ввода-вывода задается аргументом `io-threads`. Так, если указать `--io-threads 2`, то arataga будет использовать всего две рабочих нити даже на 16-ядерном процессоре.

## -l, --log-level

`-l[level]` или `--log-level=[level]`

*Опциональный параметр.*

Задает минимальный уровень важности для сообщений лога, которые должны записываться в журнал.

Так, если задан уровень `info`, то в журнал не будут попадать сообщения с уровнями `trace` и `debug`.

Разрешенные значения: `trace`, `debug`, `info`, `warn`, `error`, `crit`.

Специальное значение `off` отключает логирование.

По умолчанию: `trace`.

**Примечание.** Заданное в командной строке значение действует только до момента чтения конфигурации (из локальной копии или при получении конфигурации через административный HTTP-вход). Если в конфигурации задана команда `log_level`, то минимальный уровень логирования устанавливается равным значению команды `log_level` из конфига.

## --local-config-path

`--local-config-path=[path]`

**Обязательный параметр.**

Задает имя каталога, в котором arataga будет сохранять локальные копии конфига и списка пользователей, полученные через административный HTTP-вход.

Этот каталог должен существовать.

У пользователя, от имени которого запускается arataga, должны быть права на создание/удаление/чтение/запись файлов в этом каталоге.

Значением может быть либо абсолютное имя каталога, либо относительное имя (относительно каталога из которого запускают arataga).

Пример:

`--local-config-path=/usr/etc/arataga/local-configs`

## --log-file-count

`--log-file-count=[non-zero-value]`

*Опциональный параметр.*

Если для логирования используются лог-файлы, то этот параметр задает максимальное количество лог-файлов в ротации. Так, если задано значение 5, то будет создаваться не более 5 лог-файлов. После этого новые лог-файлы будут перезаписывать старые.

Например, если задано:

`--log-target=/var/log/arataga --log-file-count=3`

то в течении работы arataga в `/var/log` будут созданы файлы `arataga`, `arataga.1`, `arataga.2`, `arataga.3`. Затем файл `arataga.3` будет удален, файл `arataga.2` будет переименован в `arataga.3`, файл `arataga.1` в `arataga.2`, а `arataga` в `arataga.1`.

Этот параметр должен иметь значение 2 или более.

По умолчанию: 3.

## --log-file-size

`--log-file-size=[bytes]`

*Опциональный параметр.*

Если для логирования используются лог-файлы, то при достижении текущим лог-файлом заданного этим параметром размера происходит переключение на другой лог-файл (выполняется ротация логов).

По умолчанию: 10MiB.

## --log-target

`--log-target=[name...]`

*Опциональный параметр.*

Задает куда будут идти сообщения лога.

Может указываться несколько раз. Каждое вхождение аргумента `--log-target` должно указывать разные типы пунктов назначения:

* консоль. Разрешенные значения: `stdout`, `stderr`;
* syslog. Задается в формате `@stream-name`, где `stream-name` -- это имя syslog-потока для сообщений;
* имя файла.

Примеры:

* логирование только в syslog в потоке `arataga`: `arataga --log-target=@arataga`;
* логирование только на стандартный поток ошибок: `arataga --log-target=stderr`;
* логирование и на стандартный поток вывода, и в syslog в потоке `arataga`: `arataga --log-target=stdout --log-target=@arataga`;
* логирование и в syslog в потоке `arataga`, и в файл `/var/log/arataga.log`: `arataga --log-target=@arataga --log-target=/var/log/arataga.log`.

Если не указан, то логирование выполняется только на stdout.

## --max-stage-startup-time

`--max-stage-startup-time=[seconds]`

*Опциональный параметр.*

Запуск arataga происходит в несколько стадий: сперва происходит попытка загрузить локальную копию списка пользователей, затем происходит попытка загрузить локальную копию конфигурационного файла, затем создается административная точка входа по HTTP.

Каждая стадия должна успешно завершится прежде чем начнется выполнение следующей стадии. Время, которое отводится стадиям на завершение своей работы ограничено. Если стадия не успела запуститься за отведенное для этого время, то работа arataga принудительно завершается.

Параметр --max-stage-startup-time позволяет задать максимальное разрешенное время для завершения работы очередной стадии запуска arataga.

Значение задается в секундах.

Значение по умолчанию: 5 секунд.

## --no-daemonize

*Опциональный параметр.*

Если указан, то arataga после старта не демонизирует себя, а продолжает работать как обычное консольное приложение.

## --setgid

`--setgid=[gid]`

*Опциональный параметр.*

Если указан, то arataga после старта выполняет системный вызов `setgid` для понижения своих привелений в системе и продолжения работы от имени группы с заданным идентификатором.

По умолчанию arataga не делает вызов `setgid`.

## --setuid

`--setuid=[uid]`

*Опциональный параметр.*

Если указан, то arataga после старта выполняет системный вызов `setuid` для понижения своих привелений в системе и продолжения работы от имени пользователя с заданным идентификатором.

По умолчанию arataga не делает вызов `setuid`.

## --so5-combined-locks

*Опциональный параметр.*

Если указан, то внутри arataga начинают использоваться специальные реализации mutex-ов, которые сочетаю в себе spin-lock-и и обычные mutex-ы. Этот режим может снизить латентность при обработке некоторых действий внутри arataga, но ценой большего расхода CPU.

По умолчанию этот режим не используется и внутри arataga применяются обычные mutex-ы.

## -f, --log-flush-level

`-f[level]` или `--log-flush-level=[level]`

*Опциональный параметр.*

Задает уровень важности сообщений в логе, при котором происходит сброс сообщений в заданные пункты назначения.

В arataga для логирования используется библиотека [spdlog](https://github.com/gabime/spdlog), которая работает в асинхронном режиме (т.е. сообщения не записываются в файл/syslog сразу). Сообщения периодически сбрасываются в файл/syslog либо по заполнению внутренних буферов spdlog-а, либо при появлении сообщений с определенным уровнем важности.

Параметр `--log-flush-level` задает уровень важности, при котором накопленные в буферах spdlog сообщения будут записываться.

Так, если задать уровень `trace`, то запись будет осущетсвяться после появления каждого сообщения (т.е. `trace` -- это минимальный уровень). Если задать уровень `warn`, то запись будет осуществляться только при появлении сообщений с уровнем `warn` или выше.

По умолчанию: `error`.

## -h, --help

Предписывает вывести справку по параметрам командной строки и завершить работу.

## -v, --version

Предписывает вывести информацию о версии и завершить работу.
