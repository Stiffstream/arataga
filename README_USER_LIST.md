# Описание структуры и содержимого файл со списком пользователей

**Примечание.** Формат файла со списком пользователей предназначался для автоматической генерации, поэтому он может выглядеть плохо приспособленным для работы с ним вручную.

## Пустые строки, комментарии и команды

Файл со списком пользователей обрабатывается построчно. Каждая строка может быть:

* пустой строкой. Т.е. не содержит ничего кроме пробельных символов;
* комментарием. Комментарием считается строка, у которой первый непробельный символ -- это символ решетка ('#').
* описанием (пользователя или доменных лимитов). Строка, первый непробельный символ в которой отличается от символа решетка ('#') считается описанием.

Например:

```
# Комментарий, после которого идет несколько пустых строк.


   # Это также комментарий, т.к. перед решеткой только пробелы.
	  # # # ##### И это комментарий.

# Следующая строка является описанием (пользователя).
192.168.1.1 3000 user 12345 = 0 0 3 34567
# Эта строка так же является описанием (пользователя).
3232235777 3003 3232235777 = 1024000 1024000 0 34568

# Эта строка является описанием (доменных лимитов).
3 = vk.com 5mibps 5mibps facebook.com 10mibps 8mibps youtube.com 4mib 2mib
```

Примечание. Комментарий должен занимать всю строку. Нельзя указывать комментарии в той же строке, где указано описание. Например, вот правильный комментарий:

```
# Для этого пользователя нет ограничений
192.168.1.1 3000 vip-client 12345 = 0 0 0 11111
```

Тогда как вот это неправильно:

```
192.168.1.1 3000 vip-client 12345 = 0 0 0 11111 # Для этого пользователя нет ограничений
```

т.к. в этом случае часть `Для этого пользователя нет ограничений` относится к описанию конкретного пользователя и вызовет ошибку разбора.

## Описание пользователя

Описание пользователя посредством одной строки, переносы на новую строку не допускаются.

Пользователи в arataga могут аутентифицироваться двумя разными способами. Под каждый способ требуется собственное описание пользователя.

Если пользователь аутентифицируется по login/password, то описание этого пользователя задается в виде:

```
IN_IPv4 IN_PORT LOGIN PASSWORD = BANDLIM_IN BANDLIM_OUT DOMAIN_LIM_ID ID
```

Если пользователь аутентифицируется по своему IP-адресу, то описание этого пользователя задается в виде:

```
IN_IPv4 IN_PORT USER_IPv4 = BANDLIM_IN BANDLIM_OUT DOMAIN_LIM_ID ID
```

Где:

* `IN_IPv4` -- это IPv4 адрес точки входа в arataga. Может задаваться как в виде целого десятичного числа, так и в привычной цифро-точечной нотации;
* `IN_PORT` -- это TCP-порт точки входа в arataga. Задается в виде целого десятичного числа;
* `LOGIN` -- имя пользователя (последовательность непробельных символов);
* `PASSWORD` -- пароль пользователя (последовательность непробельных символов);
* `USER_IPv4` -- это IPv4 адрес, с которого пользователю разрешается подключаться к arataga без предъявления login/password. Может задаваться как в виде целого десятичного числа, так и в привычной цифро-точечной нотации;
* `BANDLIM_IN` -- лимит пропускной способности для данных, которые пользователь скачивает с целевых узлов. Значение 0 указывает на отсутствие лимита;
* `BANDLIM_OUT` -- лимит пропускной способности для данных, которые пользователь загружает на целевые узлы. Значение 0 указывает на отсутствие лимита;
* `DOMAIN_LIM_ID` -- идентификатор описания доменных лимитов. Целое десятичное число. Отсутствие такого описания ошибкой не считается, в таком случае принимается, что для пользователя доменные лимиты не заданы;
* `ID` -- идентификатор пользователя. Целое десятичное число.

Примеры:

```
# Вход для клиента на 192.168.1.1:3000 по login/password.
# Лимитов для клиента нет.
192.168.1.1 3000 vip-client 12345 = 0 0 0 11111

# Вход для клиента на 192.168.1.1:3000 по login/password.
# IP-адрес точки входа задан в виде integer.
# Лимитов для клиента нет.
3232235777 3000 another-client 34567 = 0 0 0 11111

# Вход для клиента на 192.168.1.1:3003 с IP-адреса 192.168.1.2.
# Лимитов для клиента нет.
3232235777 3003 3232235778 = 0 0 0 11111

# Вход для клиента на 192.168.1.1:3003 с IP-адреса 192.168.1.3.
# Лимитов для клиента нет.
192.168.1.1 3003 3232235779 = 0 0 0 11111

# Вход для клиента на 192.168.1.1:3003 с IP-адреса 192.168.1.100.
# Лимитов для клиента нет.
3232235777 3003 192.168.1.100 = 0 0 0 11111

# Вход для клиента на 192.168.1.1:3000 по login/password.
# Для клиента заданы лимиты.
192.168.1.1 3000 user 12345 = 1024000 512000 0 1234567

# Вход для клиента на 192.168.1.1:3003 с IP-адреса 192.168.1.100.
# Для клиента заданы лимиты.
3232235777 3003 192.168.1.100 = 100kib 75kib 0 1234567

# Вход для клиента на 192.168.1.1:3005 с IP-адреса 192.168.1.100.
# Для клиента не заданы собственные лимиты, но есть доменные лимиты.
192.168.1.1 3005 192.168.1.100 = 0 0 15 1234567

# Вход для клиента на 192.168.1.1:3007 по login/password.
# Для клиента заданы и собственные, и доменные лимиты.
192.168.1.1 3007 user 12345 = 1024000 512000 15 1234567
```

## Описание доменных лимитов

Описание доменных лимитов выполняется в одну строку, переносы описания на новую строку не допускаются.

Каждый доменный лимит должен иметь собственный уникальный целочисленный идентификатор.

Описание доменных лимитов имеет следующий формат:

```
DOMAIN_LIM_ID = DOMAIN1 BANDLIM_IN1 BANDLIM_OUT1 [DOMAIN2 BANDLIM_IN2 BANDLIM_OUT2 [...]]
```

(здесь квадратные скобки обозначают необязательную часть, т.е. то, что может отсутствовать),

где:

* `DOMAIN_LIM_ID` -- это целочисленный идентификатор лимита в десятичном виде;
* `DOMAIN(i)` -- это имя домена, для которого задаются лимиты;
* `BANDLIM_IN(i)` -- это лимит для данных, которые пользователь скачивает с указанного домена (и его поддоменов). Значение 0 указывает на отсутствие лимита;
* `BANDLIM_OUT(i)` -- это лимит для данных, которые пользователь загружает на указанный домен (и его поддомены). Значение 0 указывает на отсутствие лимита.

Например:

```
# Всего один домен в лимитах.
15 = vk.com 5mib 3mib

# Несколько доменов в лимитах.
16 = vk.com 10mib 5mib facebook.com 7mib 4mib youtube.com 10mib 2mib
```

Можно задавать и лимит для домена, и лимит для конкретного поддомена. Например:

```
# Для vk.com и любых поддоменов за исключением static.vk.com будет лимит 10/5mib.
# Для домена static.vk.com и его поддоменов будет лимит 20/1mib.
17 = vk.com 10mib 5mib static.vk.com 20mib 1mib
```
